<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ§­ ä»Šæ—¥æ¸¸ç©é€‰æ‹©å™¨</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", Arial;
    background: #f7f7f7;
    margin: 0;
    padding: 16px;
    color: #222;
}

h1 { font-size: 26px; margin-bottom: 6px; }
.subtitle { color: #666; margin-bottom: 16px; }

label { display:block; margin-top:8px; color:#555; }
input {
    width:100%; padding:12px; font-size:18px;
    border-radius:10px; border:1px solid #ccc;
}

button {
    width:100%; padding:14px; margin-top:12px;
    font-size:18px; border:none; border-radius:12px;
    background:#007aff; color:white;
}

.card {
    background:white; border-radius:14px;
    padding:16px; margin-top:14px;
    box-shadow:0 2px 8px rgba(0,0,0,0.05);
}

.item { font-size:17px; margin:6px 0; }
.small { font-size:14px; color:#666; }

.secondary { background:#e5e5ea; color:black; }
.danger { background:#ff3b30; }
</style>
</head>

<body>

<h1>ğŸ§­ ä»Šæ—¥æ¸¸ç©æ¨è</h1>
<div class="subtitle">è·ç¦»ä¼˜å…ˆ Â· ä¸çº ç»“ Â· 3 é€‰ 1</div>

<label>ğŸ‘¤ å¤§å</label>
<input id="name" placeholder="è¯·è¾“å…¥ä½ çš„åå­—">

<label>ğŸ“… æ—¥æœŸ</label>
<input id="date" type="date">

<button onclick="generate()">ğŸ¯ ç”Ÿæˆæ¸¸ç©ç»„åˆ</button>

<div id="options"></div>
<div id="final"></div>

<button class="secondary" onclick="showHistory()">ğŸ“œ æŸ¥çœ‹å†å²</button>
<button class="danger" onclick="clearHistory()">ğŸ§¹ æ¸…é™¤å†å²</button>

<script>
// ========= æ•°æ® =========
const categories = {
  "å’–å•¡åº—": [
    ["Dear Deer Coffee",-36.8890,174.9270],
    ["Handpicked Coffee",-36.8736,174.7764],
    ["Mezze Bar Coffee",-36.8702,174.7781],
    ["Espresso Workshop",-36.8680,174.7770],
    ["Remedy Coffee",-36.8477,174.7650],
    ["Little Q Coffee",-36.8725,174.7752],
  ],
  "å¤è‘£åº—": [
    ["The Collectors",-36.8790,174.8120],
    ["Vitrine",-36.8575,174.7778],
    ["The Poi Room",-36.8618,174.7754],
    ["Artisan Antiques",-36.8688,174.7722],
    ["Old Charm Studio",-36.8710,174.7810],
    ["Heritage Room",-36.8655,174.7790],
  ],
  "æµ·æ»©": [
    ["Mission Bay",-36.8489,174.8306],
    ["St Heliers",-36.8485,174.8560],
    ["Kohimarama",-36.8482,174.8418],
    ["Ladies Bay",-36.8550,174.8285],
    ["Okahu Bay",-36.8438,174.7972],
    ["Judges Bay",-36.8471,174.8014],
  ],
  "å®¶å…·åº—": [
    ["Nood",-36.8712,174.7760],
    ["Mocka Sylvia Park",-36.9175,174.8478],
    ["Danske Mobler",-36.8793,174.8126],
    ["Target Furniture",-36.9051,174.8532],
    ["Freedom Furniture",-36.8844,174.8460],
    ["Urban Sales",-36.8720,174.7769],
  ],
  "ä¸­å¼ç”œå“": [
    ["Aroma Dessert",-36.8899,174.7577],
    ["EVERSWEET",-36.8869,174.9271],
    ["Spoonful ä¸€å£ç”œ",-36.8980,174.9500],
    ["Soul Sweet",-36.8904,174.8679],
    ["Little Sweet Corner",-36.8820,174.8450],
    ["Oriental Sugar House",-36.8785,174.8300],
  ],
  "ä¸­å¼å¥¶èŒ¶/æœèŒ¶": [
    ["Tea Talk Sylvia",-36.9104,174.8619],
    ["Tea Talk Newmarket",-36.8715,174.7773],
    ["NOMI Botany",-36.8859,174.9456],
    ["ChaBliss",-36.8650,174.7769],
    ["Teadee",-36.8732,174.7762],
    ["Hokey Pokey Tea",-36.8929,174.7994],
  ]
};

// ========= è·ç¦» =========
function haversine(a,b,c,d){
    const R=6371;
    const p=Math.PI/180;
    const dlat=(c-a)*p, dlon=(d-b)*p;
    const x=Math.sin(dlat/2)**2+
        Math.cos(a*p)*Math.cos(c*p)*Math.sin(dlon/2)**2;
    return 2*R*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));
}

function comboDistance(points){
    let d=0;
    for(let i=0;i<points.length;i++)
        for(let j=i+1;j<points.length;j++)
            d+=haversine(
              points[i][1],points[i][2],
              points[j][1],points[j][2]
            );
    return d.toFixed(2);
}

// ========= ç”Ÿæˆ =========
function generate(){
    const name=document.getElementById("name").value.trim();
    if(!name){ alert("è¯·å…ˆè¾“å…¥åå­—"); return; }

    const box=document.getElementById("options");
    box.innerHTML="â³ æ­£åœ¨è®¡ç®—æœ€ä¼˜è·¯çº¿...";

    setTimeout(()=>{
        box.innerHTML="";
        const cats=Object.keys(categories);

        for(let i=0;i<3;i++){
            const chosen=[];
            while(chosen.length<3){
                const c=cats[Math.floor(Math.random()*cats.length)];
                if(!chosen.find(x=>x.cat===c)){
                    const item=categories[c][Math.floor(Math.random()*6)];
                    chosen.push({cat:c,item});
                }
            }

            const dist=comboDistance(chosen.map(x=>x.item));
            const card=document.createElement("div");
            card.className="card";
            card.innerHTML=`
              <h3>æ–¹æ¡ˆ ${i+1}</h3>
              ${chosen.map(x=>`<div class="item">ğŸ“ ${x.item[0]}ï¼ˆ${x.cat}ï¼‰</div>`).join("")}
              <div class="small">ğŸš— æ€»è·ç¦»çº¦ ${dist} km</div>
              <button onclick='choose(${JSON.stringify(chosen)}, "${dist}")'>é€‰è¿™ä¸ª</button>
            `;
            box.appendChild(card);
        }
    },3000);
}

function choose(list,dist){
    const history=JSON.parse(localStorage.getItem("playHistory")||"[]");
    history.push({date:new Date().toLocaleDateString(), list, dist});
    localStorage.setItem("playHistory",JSON.stringify(history));

    document.getElementById("options").innerHTML="";
    document.getElementById("final").innerHTML=`
      <div class="card">
        <h2>âœ… ä»Šæ—¥æ¸¸ç©</h2>
        ${list.map(x=>`<div class="item">ğŸ“ ${x.item[0]}ï¼ˆ${x.cat}ï¼‰</div>`).join("")}
        <div class="small">ğŸš— æ€»è·ç¦» ${dist} km</div>
      </div>
    `;
}

function showHistory(){
    const h=JSON.parse(localStorage.getItem("playHistory")||"[]");
    if(!h.length){ alert("æš‚æ— å†å²"); return; }
    alert(h.map(x=>`${x.date}\n${x.list.map(i=>i.item[0]).join(" â†’ ")}`).join("\n\n"));
}

function clearHistory(){
    if(confirm("ç¡®å®šæ¸…ç©ºæ¸¸ç©å†å²ï¼Ÿ")){
        localStorage.removeItem("playHistory");
        alert("å·²æ¸…ç©º");
    }
}

document.getElementById("date").value=
    new Date().toISOString().slice(0,10);
</script>

</body>
</html>
