<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¯ ä»Šæ—¥æ¸¸ç©æ¨è</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", Arial;
    background:#f7f7f7;
    margin:0;
    padding:16px;
}
h1 { font-size:26px; margin-bottom:6px; }
.subtitle { color:#666; margin-bottom:16px; }

label { display:block; margin-top:8px; color:#555; }
input {
    width:100%;
    padding:12px;
    font-size:18px;
    border-radius:10px;
    border:1px solid #ccc;
}

button {
    width:100%;
    padding:14px;
    margin-top:10px;
    font-size:18px;
    border:none;
    border-radius:12px;
    background:#007aff;
    color:#fff;
}
button.secondary { background:#e5e5ea; color:#000; }
button.danger { background:#ff3b30; }

.card {
    background:#fff;
    border-radius:14px;
    padding:16px;
    margin-top:14px;
    box-shadow:0 2px 8px rgba(0,0,0,0.05);
}
.item { font-size:18px; margin:6px 0; }
.small { font-size:15px; color:#666; }
</style>
</head>

<body>

<h1>ğŸ¯ ä»Šæ—¥æ¸¸ç©æ¨è</h1>
<div class="subtitle">è·ç¦»å‹å¥½ Â· ä¸çº ç»“ Â· ç›´æ¥é€‰</div>

<label>ğŸ‘¤ å¤§å</label>
<input id="name" placeholder="è¯·è¾“å…¥åå­—">

<label>ğŸ“… æ—¥æœŸ</label>
<input id="date" type="date">

<button onclick="generate()">ğŸ² æ¨èæ¸¸ç©</button>

<div id="options"></div>
<div id="final"></div>
<div id="historyBox"></div>

<button class="secondary" onclick="showHistory()">ğŸ“œ æŸ¥çœ‹å†å²</button>
<button class="danger" onclick="clearHistory()">ğŸ§¹ æ¸…é™¤å†å²</button>

<script>
// ===== åœ°ç‚¹æ•°æ®ï¼ˆç¤ºä¾‹ï¼Œå¯ç»§ç»­æ‰©å……ï¼‰=====
const places = [
    {name:"å’–å•¡åº— â˜•", lat:-36.85, lon:174.76},
    {name:"æµ·æ»© ğŸŒŠ", lat:-36.84, lon:174.83},
    {name:"å¤è‘£åº— ğŸª‘", lat:-36.87, lon:174.78},
    {name:"å®¶å…·åº— ğŸ›‹ï¸", lat:-36.90, lon:174.85},
    {name:"ç”œå“åº— ğŸ°", lat:-36.88, lon:174.80},
    {name:"å¥¶èŒ¶åº— ğŸ§‹", lat:-36.89, lon:174.82}
];

// ===== è·ç¦»ç®—æ³•ï¼ˆJS ç‰ˆ haversineï¼‰=====
function haversine(a, b){
    const R = 6371;
    const dLat = (b.lat - a.lat) * Math.PI / 180;
    const dLon = (b.lon - a.lon) * Math.PI / 180;
    const lat1 = a.lat * Math.PI / 180;
    const lat2 = b.lat * Math.PI / 180;

    const x = Math.sin(dLat/2)**2 +
              Math.cos(lat1) * Math.cos(lat2) *
              Math.sin(dLon/2)**2;

    return 2 * R * Math.atan2(Math.sqrt(x), Math.sqrt(1-x));
}

function totalDistance(list){
    let d = 0;
    for(let i=0;i<list.length;i++){
        for(let j=i+1;j<list.length;j++){
            d += haversine(list[i], list[j]);
        }
    }
    return d.toFixed(2);
}

function rand(arr){
    return arr[Math.floor(Math.random()*arr.length)];
}

function makePlan(){
    const plan = [rand(places), rand(places), rand(places)];
    return {
        plan,
        distance: totalDistance(plan)
    };
}

// ===== ç”Ÿæˆæ–¹æ¡ˆ =====
function generate(){
    const name = document.getElementById("name").value.trim();
    const date = document.getElementById("date").value;
    if(!name){ alert("è¯·å…ˆè¾“å…¥å¤§å"); return; }

    document.getElementById("options").innerHTML = "â³ æ­£åœ¨ç”Ÿæˆæ¸¸ç©æ–¹æ¡ˆ...";
    document.getElementById("final").innerHTML = "";
    document.getElementById("historyBox").innerHTML = "";

    setTimeout(()=>{
        const box = document.getElementById("options");
        box.innerHTML = "";
        for(let i=0;i<3;i++){
            const r = makePlan();
            const c = document.createElement("div");
            c.className="card";
            c.innerHTML = `
                <h3>æ–¹æ¡ˆ ${i+1}</h3>
                <div class="item">ğŸ“ ${r.plan[0].name}</div>
                <div class="item">ğŸ“ ${r.plan[1].name}</div>
                <div class="item">ğŸ“ ${r.plan[2].name}</div>
                <div class="small">ğŸ“ æ€»è·ç¦» ${r.distance} km</div>
                <button onclick='choose(${JSON.stringify(r)}, "${name}", "${date}")'>é€‰æ‹©è¿™ä¸ª</button>
            `;
            box.appendChild(c);
        }
    }, 3000);
}

// ===== é€‰æ‹©å¹¶ä¿å­˜ =====
function choose(result, name, date){
    const history = JSON.parse(localStorage.getItem("playHistory") || "[]");
    history.push({name, date, ...result});
    localStorage.setItem("playHistory", JSON.stringify(history));

    document.getElementById("options").innerHTML = "";
    document.getElementById("final").innerHTML = `
        <div class="card">
            <h2>âœ… ä»Šæ—¥æ¸¸ç©</h2>
            <div class="item">ğŸ“ ${result.plan[0].name}</div>
            <div class="item">ğŸ“ ${result.plan[1].name}</div>
            <div class="item">ğŸ“ ${result.plan[2].name}</div>
            <div class="small">ğŸ“ æ€»è·ç¦» ${result.distance} km</div>
        </div>
    `;
}

// ===== é¡µé¢æ˜¾ç¤ºå†å² =====
function showHistory(){
    const box = document.getElementById("historyBox");
    const history = JSON.parse(localStorage.getItem("playHistory") || "[]");
    box.innerHTML = "";

    if(!history.length){
        box.innerHTML = "<div class='card'>æš‚æ— å†å²è®°å½•</div>";
        return;
    }

    history.forEach(h=>{
        box.innerHTML += `
            <div class="card">
                <div class="item"><strong>${h.date}</strong> Â· ${h.name}</div>
                <div class="item">ğŸ“ ${h.plan[0].name}</div>
                <div class="item">ğŸ“ ${h.plan[1].name}</div>
                <div class="item">ğŸ“ ${h.plan[2].name}</div>
                <div class="small">ğŸ“ æ€»è·ç¦» ${h.distance} km</div>
            </div>
        `;
    });
}

// ===== æ¸…é™¤å†å² =====
function clearHistory(){
    if(confirm("ç¡®å®šæ¸…é™¤æ‰€æœ‰æ¸¸ç©å†å²å—ï¼Ÿ")){
        localStorage.removeItem("playHistory");
        document.getElementById("historyBox").innerHTML = "";
        alert("å†å²å·²æ¸…é™¤");
    }
}

// é»˜è®¤æ—¥æœŸ
document.getElementById("date").value =
    new Date().toISOString().slice(0,10);
</script>

<footer style="
    margin-top:40px;
    text-align:center;
    font-size:14px;
    color:#999;
    padding-bottom:20px;
">
    Designed by BY
</footer>

</body>
</html>
