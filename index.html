<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ—º æ¸¸ç©é€‰æ‹©å™¨</title>

<style>
body{
    font-family:-apple-system,BlinkMacSystemFont,"PingFang SC",Arial;
    background:#f7f7f7;
    margin:0;
    padding:16px;
    color:#222;
}
h1{font-size:26px;margin-bottom:6px;}
.subtitle{font-size:16px;color:#666;margin-bottom:16px;}
label{display:block;font-size:16px;margin:6px 0 4px;color:#555;}
input{
    width:100%;padding:12px;font-size:18px;
    margin-bottom:10px;border-radius:10px;border:1px solid #ccc;
}
.card{
    background:#fff;border-radius:14px;padding:16px;
    margin-bottom:14px;box-shadow:0 2px 8px rgba(0,0,0,.05);
}
.item{font-size:18px;margin:6px 0;}
.distance{font-size:15px;color:#555;margin-top:8px;}
button{
    width:100%;padding:14px;margin-top:10px;
    font-size:18px;border-radius:12px;border:none;
    background:#007aff;color:#fff;
}
button.secondary{background:#e5e5ea;color:#000;}
button.danger{background:#ff3b30;}
.footer{text-align:center;font-size:14px;color:#999;margin-top:30px;}
</style>
</head>

<body>

<h1>ğŸ—º ä»Šæ—¥æ¸¸ç©æ¨è</h1>
<div class="subtitle">æŒ‰è·ç¦» Â· ä¸çº ç»“ Â· ç›´æ¥å»</div>

<label>ğŸ‘¤ å¤§å</label>
<input id="name" placeholder="è¯·è¾“å…¥ä½ çš„åå­—">

<label>ğŸ“… é€‰æ‹©æ—¥æœŸ</label>
<input id="date" type="date">

<button onclick="generate()">ğŸ¯ æ¨èæ¸¸ç©</button>

<sdiv id="options"></div>
<div id="final"></div>
<div id="historyBox"></div>

<button class="secondary" onclick="showHistory()">ğŸ“œ æŸ¥çœ‹å†å²</button>
<button class="danger" onclick="clearHistory()">ğŸ§¹ æ¸…é™¤å†å²</button>

script>
// ========= è·ç¦» =========
function rad(d){return d*Math.PI/180;}
function haversine(a,b,c,d){
    const R=6371;
    const x=rad(c-a),y=rad(d-b);
    const z=Math.sin(x/2)**2+
        Math.cos(rad(a))*Math.cos(rad(c))*Math.sin(y/2)**2;
    return 2*R*Math.atan2(Math.sqrt(z),Math.sqrt(1-z));
}
function totalDistance(ps){
    let d=0;
    for(let i=0;i<ps.length;i++)
        for(let j=i+1;j<ps.length;j++)
            d+=haversine(ps[i].lat,ps[i].lon,ps[j].lat,ps[j].lon);
    return d.toFixed(2);
}

// ========= æ•°æ®ï¼ˆä½ ç»™çš„å®Œæ•´åˆ†ç±»ï¼‰ =========
const categories = {
    "å’–å•¡åº—": [
        {name:"Dear Deer Coffee",lat:-36.8890,lon:174.9270},
        {name:"Handpicked Coffee",lat:-36.8736,lon:174.7764},
        {name:"Mezze Bar Coffee",lat:-36.8702,lon:174.7781},
        {name:"Espresso Workshop",lat:-36.8680,lon:174.7770},
        {name:"Remedy Coffee",lat:-36.8477,lon:174.7650},
        {name:"Little Q Coffee",lat:-36.8725,lon:174.7752}
    ],
    "å¤è‘£åº—": [
        {name:"The Collectors",lat:-36.8790,lon:174.8120},
        {name:"Vitrine",lat:-36.8575,lon:174.7778},
        {name:"The Poi Room",lat:-36.8618,lon:174.7754},
        {name:"Artisan Antiques",lat:-36.8688,lon:174.7722},
        {name:"Old Charm Studio",lat:-36.8710,lon:174.7810},
        {name:"Heritage Room",lat:-36.8655,lon:174.7790}
    ],
    "æµ·æ»©": [
        {name:"Mission Bay",lat:-36.8489,lon:174.8306},
        {name:"St Heliers Beach",lat:-36.8485,lon:174.8560},
        {name:"Kohimarama Beach",lat:-36.8482,lon:174.8418},
        {name:"Ladies Bay",lat:-36.8550,lon:174.8285},
        {name:"Okahu Bay",lat:-36.8438,lon:174.7972},
        {name:"Judges Bay",lat:-36.8471,lon:174.8014}
    ],
    "å®¶å…·åº—": [
        {name:"Nood",lat:-36.8712,lon:174.7760},
        {name:"Mocka Sylvia Park",lat:-36.9175,lon:174.8478},
        {name:"Danske Mobler",lat:-36.8793,lon:174.8126},
        {name:"Target Furniture",lat:-36.9051,lon:174.8532},
        {name:"Freedom Furniture",lat:-36.8844,lon:174.8460},
        {name:"Urban Sales",lat:-36.8720,lon:174.7769}
    ],
    "ä¸­å¼ç”œå“": [
        {name:"Aroma Dessert Studio",lat:-36.8899,lon:174.7577},
        {name:"EVERSWEET",lat:-36.8869,lon:174.9271},
        {name:"Spoonful ä¸€å£ç”œ",lat:-36.8980,lon:174.9500},
        {name:"Soul Sweet ç”œåŒ ",lat:-36.8904,lon:174.8679},
        {name:"Little Sweet Corner",lat:-36.8820,lon:174.8450},
        {name:"Oriental Sugar House",lat:-36.8785,lon:174.8300}
    ],
    "ä¸­å¼å¥¶èŒ¶/æœèŒ¶": [
        {name:"Tea Talk Sylvia Park",lat:-36.9104,lon:174.8619},
        {name:"Tea Talk Newmarket",lat:-36.8715,lon:174.7773},
        {name:"NOMI Botany",lat:-36.8859,lon:174.9456},
        {name:"ChaBliss åƒèŒ¶å»",lat:-36.8650,lon:174.7769},
        {name:"Teadee Bubble Tea",lat:-36.8732,lon:174.7762},
        {name:"Hokey Pokey Tea House",lat:-36.8929,lon:174.7994}
    ]
};

// ========= ç”Ÿæˆé€»è¾‘ =========
function rand(a){return a[Math.floor(Math.random()*a.length)];}

function makeCombo(){
    const cats = Object.keys(categories).sort(()=>0.5-Math.random()).slice(0,3);
    const points = cats.map(c=>{
        const p = rand(categories[c]);
        return {...p,category:c};
    });
    return {points,distance:totalDistance(points)};
}

function generate(){
    const name=document.getElementById("name").value.trim();
    if(!name){alert("è¯·å…ˆè¾“å…¥å¤§å");return;}

    document.getElementById("options").innerHTML="â³ æ­£åœ¨è§„åˆ’è·¯çº¿...";
    document.getElementById("final").innerHTML="";
    document.getElementById("historyBox").innerHTML="";

    setTimeout(()=>{
        const box=document.getElementById("options");
        box.innerHTML="";
        for(let i=0;i<3;i++){
            const c=makeCombo();
            const card=document.createElement("div");
            card.className="card";
            card.innerHTML=`
                <h3>æ–¹æ¡ˆ ${i+1}</h3>
                ${c.points.map(p=>`
                    <div class="item">ğŸ“ ${p.category}ï¼š<strong>${p.name}</strong></div>
                `).join("")}
                <div class="distance">ğŸ“ æ€»è·ç¦» ${c.distance} km</div>
                <button onclick='choose(${JSON.stringify(c)},"${name}")'>é€‰æ‹©è¿™ä¸ª</button>
            `;
            box.appendChild(card);
        }
    },3000);
}

function choose(combo,name){
    const h=JSON.parse(localStorage.getItem("playHistory")||"[]");
    h.push({date:new Date().toLocaleDateString(),name,combo});
    localStorage.setItem("playHistory",JSON.stringify(h));

    document.getElementById("options").innerHTML="";
    document.getElementById("final").innerHTML=`
        <div class="card">
            <h2>âœ… ä»Šæ—¥æ¸¸ç©</h2>
            ${combo.points.map(p=>`
                <div class="item">ğŸ“ ${p.category}ï¼š${p.name}</div>
            `).join("")}
            <div class="distance">ğŸ“ ${combo.distance} km</div>
        </div>
    `;
}

function showHistory(){
    const box=document.getElementById("historyBox");
    const h=JSON.parse(localStorage.getItem("playHistory")||"[]");
    box.innerHTML="";
    if(!h.length){
        box.innerHTML="<div class='card'>æš‚æ— å†å²è®°å½•</div>";
        return;
    }
    h.forEach(x=>{
        box.innerHTML+=`
            <div class="card">
                <strong>${x.date}</strong> Â· ${x.name}
                ${x.combo.points.map(p=>`
                    <div class="item">ğŸ“ ${p.category}ï¼š${p.name}</div>
                `).join("")}
                <div class="distance">ğŸ“ ${x.combo.distance} km</div>
            </div>
        `;
    });
}

function clearHistory(){
    if(confirm("ç¡®å®šæ¸…é™¤æ‰€æœ‰æ¸¸ç©å†å²ï¼Ÿ")){
        localStorage.removeItem("playHistory");
        document.getElementById("historyBox").innerHTML="";
    }
}

document.getElementById("date").value =
    new Date().toISOString().slice(0,10);
</script>

<footer style="
    margin-top:48px;
    text-align:center;
    font-size:13px;
    color:#aaa;
    letter-spacing:0.5px;
    padding-bottom:24px;
">
    â€” Design by BY â€”
</footer>
    
</body>
</html>
